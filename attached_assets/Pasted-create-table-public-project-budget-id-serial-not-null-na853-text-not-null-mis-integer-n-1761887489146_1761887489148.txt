create table public.project_budget (
  id serial not null,
  na853 text not null,
  mis integer not null,
  proip numeric(15, 2) null default 0,
  ethsia_pistosi numeric(15, 2) null default 0,
  q1 numeric(15, 2) null default 0,
  q2 numeric(15, 2) null default 0,
  q3 numeric(15, 2) null default 0,
  q4 numeric(15, 2) null default 0,
  katanomes_etous numeric(15, 2) null default 0,
  user_view numeric(15, 2) null default 0,
  created_at timestamp with time zone null default CURRENT_TIMESTAMP,
  updated_at timestamp with time zone null default CURRENT_TIMESTAMP,
  last_quarter_check text null default 'q1'::text,
  sum jsonb null,
  project_id integer not null,
  year_close jsonb null,
  constraint budget_na853_split_pkey primary key (id),
  constraint budget_na853_split_mis_key unique (mis),
  constraint budget_na853_split_na853_key unique (na853),
  constraint budget_na853_split_mis_fkey foreign KEY (mis) references "Projects" (mis) on update CASCADE,
  constraint budget_na853_split_project_id_fkey foreign KEY (project_id) references "Projects" (id),
  constraint valid_amounts check (
    (
      (proip >= (0)::numeric)
      and (ethsia_pistosi >= (0)::numeric)
      and (q1 >= (0)::numeric)
      and (q2 >= (0)::numeric)
      and (q3 >= (0)::numeric)
      and (q4 >= (0)::numeric)
      and (katanomes_etous >= (0)::numeric)
      and (user_view >= (0)::numeric)
    )
  )
) TABLESPACE pg_default;

create index IF not exists idx_budget_mis on public.project_budget using btree (mis) TABLESPACE pg_default;

create index IF not exists idx_budget_na853 on public.project_budget using btree (na853) TABLESPACE pg_default;

create index IF not exists idx_project_budget_project_id on public.project_budget using btree (project_id) TABLESPACE pg_default;

create trigger trg_project_budget_set_project_id BEFORE INSERT
or
update OF mis on project_budget for EACH row
execute FUNCTION project_budget_set_project_id ();

create trigger update_budget_updated_at BEFORE
update on project_budget for EACH row
execute FUNCTION update_updated_at_column ();