--- server/utils/DocumentFormatter.ts.old
+++ server/utils/DocumentFormatter.ts
@@ -1043,10 +1043,13 @@
     // Process each recipient
     recipients.forEach((recipient, index) => {
-      // Check if fathername exists and is not empty
-      const fullName = !recipient.fathername || recipient.fathername.trim() === ""
-        ? `${recipient.lastname} ${recipient.firstname}`.trim()
-        : `${recipient.lastname} ${recipient.firstname} ΤΟΥ ${recipient.fathername}`.trim();
-      const afm = recipient.afm;
+      // Ensure all recipient properties exist and handle undefined/null values safely
+      const firstname = recipient.firstname || '';
+      const lastname = recipient.lastname || '';
+      const fathername = recipient.fathername || '';
+      
+      // Check if fathername exists and is not empty
+      const fullName = !fathername || fathername.trim() === ""
+        ? `${lastname} ${firstname}`.trim()
+        : `${lastname} ${firstname} ΤΟΥ ${fathername}`.trim();
+      const afm = recipient.afm || '';
       const rowNumber = (index + 1).toString() + ".";

@@ -1274,10 +1277,13 @@
     // Process each recipient
     recipients.forEach((recipient, index) => {
-      // Check if fathername exists and is not empty
-      const fullName = !recipient.fathername || recipient.fathername.trim() === ""
-        ? `${recipient.lastname} ${recipient.firstname}`.trim()
-        : `${recipient.lastname} ${recipient.firstname} ΤΟΥ ${recipient.fathername}`.trim();
-      const afm = recipient.afm;
+      // Ensure all recipient properties exist and handle undefined/null values safely
+      const firstname = recipient.firstname || '';
+      const lastname = recipient.lastname || '';
+      const fathername = recipient.fathername || '';
+      
+      // Check if fathername exists and is not empty
+      const fullName = !fathername || fathername.trim() === ""
+        ? `${lastname} ${firstname}`.trim()
+        : `${lastname} ${firstname} ΤΟΥ ${fathername}`.trim();
+      const afm = recipient.afm || '';
       const rowNumber = (index + 1).toString() + ".";

--- client/src/components/documents/orthi-epanalipsi-modal.tsx.old
+++ client/src/components/documents/orthi-epanalipsi-modal.tsx
@@ -163,11 +163,12 @@
   useEffect(() => {
     if (document && isOpen) {
       form.reset({
+        correctionReason: "",
         project_id: String(document.project_id),
         project_na853: document.project_na853,
         unit: document.unit,
         expenditure_type: document.expenditure_type,
-        recipients: document.recipients,
+        recipients: Array.isArray(document.recipients) ? document.recipients : [],
         total_amount: document.total_amount,
       });
       setSelectedProject(String(document.project_id));
@@ -175,10 +176,18 @@
   }, [document, isOpen]);

   const addRecipient = () => {
-    const recipients = form.getValues("recipients") || [];
+    const currentRecipients = form.getValues("recipients") || [];
+    
+    if (currentRecipients.length >= 15) {
+      toast({
+        title: "Προσοχή",
+        description: "Μέγιστος αριθμός δικαιούχων: 15",
+        variant: "destructive",
+      });
+      return;
+    }
     form.setValue("recipients", [
-      ...recipients,
+      ...currentRecipients,
       { firstname: "", lastname: "", fathername: "", afm: "", amount: 0, installment: 1 }
     ]);
   };

--- client/src/components/documents/document-modals.tsx.old
+++ client/src/components/documents/document-modals.tsx
@@ -254,7 +254,7 @@
       setExpenditureType(document.expenditure_type || '');

       // Safely parse recipients array
-      const safeRecipients = Array.isArray(document.recipients)
+      const safeRecipients = document.recipients && Array.isArray(document.recipients)
         ? document.recipients.map(r => ({
             firstname: String(r.firstname || ''),
             lastname: String(r.lastname || ''),
@@ -282,7 +282,7 @@
   };

   const addRecipient = () => {
-    if (recipients.length >= 10) {
+    if (recipients.length >= 15) {
       toast({
         title: "Error",
         description: "Maximum 10 recipients allowed",
@@ -335,10 +335,14 @@
         }
 
         return {
-          firstname: String(r.firstname).trim(),
-          lastname: String(r.lastname).trim(),
-          afm: String(r.afm).trim(),
-          amount,
+          // Handle potentially undefined values safely
+          firstname: r.firstname ? String(r.firstname).trim() : '',
+          lastname: r.lastname ? String(r.lastname).trim() : '',
+          fathername: r.fathername ? String(r.fathername).trim() : '',
+          afm: r.afm ? String(r.afm).trim() : '',
+          // Convert amounts properly
+          amount: parseFloat(String(amount)),
+          // Ensure installment is a number
           installment
         };
       });